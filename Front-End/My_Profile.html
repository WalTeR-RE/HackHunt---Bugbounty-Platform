<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Profile - HackHunt</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0f172a;
      color: white;
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center py-12 px-4">

  <h1 class="text-3xl font-bold text-purple-500 mb-8">My Profile</h1>

  <div class="w-full max-w-2xl bg-gray-900 p-6 rounded-xl shadow-lg border border-purple-700">
    <div class="flex items-center space-x-4 mb-6">
      <img id="profile-picture" src="" alt="Profile Picture" class="w-24 h-24 rounded-full border-2 border-purple-700 object-cover">
      <div>
        <h2 id="name" class="text-xl font-bold text-white">Name</h2>
        <p id="nickname" class="text-purple-400">@nickname</p>
      </div>
    </div>

    <div class="space-y-2 mb-4">
      <p><span class="text-purple-400 font-semibold">Email:</span> <span id="email"></span></p>
      <p><span class="text-purple-400 font-semibold">Country:</span> <span id="country"></span></p>
      <p><span class="text-purple-400 font-semibold">Birthday:</span> <span id="birthday"></span></p>
      <p><span class="text-purple-400 font-semibold">Rank:</span> <span id="rank"></span></p>
      <p><span class="text-purple-400 font-semibold">Total Points:</span> <span id="total_points"></span></p>
      <p><span class="text-purple-400 font-semibold">Accuracy:</span> <span id="accuracy"></span></p>
      <p><span class="text-purple-400 font-semibold">About Me:</span> <span id="about_me"></span></p>
    </div>

    <!-- Logout Button -->
    <div class="text-right">
      <button id="logoutBtn" class="bg-purple-700 hover:bg-purple-800 text-white font-semibold py-2 px-4 rounded">
        Logout
      </button>
    </div>
  </div>

 

  <script>
    async function fetchProfile() {
      const token = localStorage.getItem('token');

      if (!token) {
        alert('No token found!');
        window.location.href = 'Login.html';
        return;
      }

      try {
        const res1 = await fetch("http://127.0.0.1:8000/api/auth/me", {
        headers: {
            "Authorization": `Bearer ${token}`
            }
        });
    
        const user = await res1.json();

        console.log("User data:", user);

        document.getElementById('profile-picture').src = user[0].profile_picture 
          ? `http://127.0.0.1:8000/storage/profile_pictures/${user[0].profile_picture}` 
          : 'default-profile.png';

        document.getElementById('name').textContent = user[0].name || 'Unknown';
        document.getElementById('nickname').textContent = '@' + (user[0].nickname || 'unknown');
        document.getElementById('email').textContent = user[0].email || '';
        document.getElementById('country').textContent = user[0].country || '';
        document.getElementById('birthday').textContent = user[0].birthday || '';
        document.getElementById('rank').textContent = user[0].rank || '';
        document.getElementById('total_points').textContent = user[0].total_points ?? 0;
        document.getElementById('accuracy').textContent = (user[0].accuracy ?? 0) + '%';
        document.getElementById('about_me').textContent = user[0].about_me || '';

      } catch (err) {
        console.error(err);
        alert('Error fetching profile');
      }
    }

    // Logout Button Handler
    document.getElementById("logoutBtn")?.addEventListener("click", async function () {
      const token = localStorage.getItem('token');

      if (!token) {
        alert("No token found!");
        return;
      }

      try {
        const response = await fetch("http://127.0.0.1:8000/api/auth/logout", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`,
            
            "Content-Type": "application/json"
          }
        });

        if (response.ok) {
          alert("Logged out successfully!");
          localStorage.removeItem("token");
          localStorage.removeItem("refresh_token");
          window.location.href = "Login.html";
        } else {
          const error = await response.json();
          alert("Logout failed: " + (error.message || "Please try again."));
        }
      } catch (err) {
        console.error(err);
        alert("An error occurred while logging out.");
      }
    });

    // Load profile on page load
   fetchProfile();
  </script>
<!-- Footer -->
<footer class="bg-gray-900 mt-12 border-t border-gray-800 text-center py-6 text-sm text-gray-400">
  <div class="max-w-7xl mx-auto px-4">
    <p>&copy; 2025 <span class="text-purple-500 font-semibold">HackHunt</span>. All rights reserved.</p>
    <p class="mt-2">
      <a href="index.html#features" class="hover:text-purple-400 transition">Features</a> ·
      <a href="Programs.html" class="hover:text-purple-400 transition">Programs</a> ·
      <a href="index.html#hall-of-fame" class="hover:text-purple-400 transition">Hall of Fame</a>
    </p>
  </div>
</footer>
</body>
</html>
